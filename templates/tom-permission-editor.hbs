<div class="tom-permission-editor-content">

  <!-- Header: avatar + name + offline toggle -->
  <header class="tom-perm-header">
    <img src="{{character.thumbnail}}" class="tom-perm-avatar" alt="{{character.name}}">
    <span class="tom-perm-name">{{character.name}}</span>
    <label class="tom-perm-offline-toggle">
      <input type="checkbox" class="tom-perm-offline-input" {{#if showOffline}}checked{{/if}}>
      <span class="tom-perm-toggle-track"></span>
      <span class="tom-perm-toggle-label">Offline</span>
    </label>
  </header>

  <!-- Default permission row -->
  <div class="tom-perm-default-row">
    <span class="tom-perm-default-label">Default</span>
    <select name="defaultPermission">
      {{#each permissionLevels}}
      <option value="{{key}}" {{#if (eq key ../defaultPermission)}}selected{{/if}}>
        {{name}} — {{description}}
      </option>
      {{/each}}
    </select>
  </div>

  <!-- Player list -->
  <div class="tom-perm-players">
    {{#each players}}
    <div class="tom-perm-player {{#unless online}}offline{{/unless}}">
      <div class="tom-perm-player-info">
        <img src="{{avatar}}" class="tom-perm-player-avatar" style="border-color: {{color}}">
        <span class="tom-perm-player-name">{{name}}</span>
        {{#unless online}}<span class="tom-perm-offline-badge">offline</span>{{/unless}}
      </div>
      <div class="tom-perm-player-buttons">
        <button type="button" class="tom-perm-btn {{#if isNone}}active{{/if}}" data-action="set-permission"
          data-user-id="{{id}}" data-level="none" title="No Access">
          <i class="fas fa-ban"></i>
        </button>
        <button type="button" class="tom-perm-btn {{#if isView}}active{{/if}}" data-action="set-permission"
          data-user-id="{{id}}" data-level="view" title="View Only">
          <i class="fas fa-eye"></i>
        </button>
        <button type="button" class="tom-perm-btn {{#if isEmotion}}active{{/if}}" data-action="set-permission"
          data-user-id="{{id}}" data-level="emotion" title="Can Change Emotions">
          <i class="fas fa-theater-masks"></i>
        </button>
        <button type="button" class="tom-perm-btn {{#if isFull}}active{{/if}} {{#if canSpawnToken}}can-spawn{{/if}}"
          data-action="set-permission" data-user-id="{{id}}" data-level="full"
          title="Full Control (Right-click to toggle token spawning)">
          <i class="fas fa-crown"></i>
        </button>
      </div>
    </div>
    {{else}}
    <div class="tom-perm-empty">
      <i class="fas fa-users-slash"></i>
      <p>No players to assign permissions.</p>
    </div>
    {{/each}}
  </div>

  <!-- Legend + spawn hint in one compact bar -->
  <div class="tom-perm-legend">
    <span class="tom-perm-legend-item"><i class="fas fa-ban"></i> None</span>
    <span class="tom-perm-legend-item"><i class="fas fa-eye"></i> View</span>
    <span class="tom-perm-legend-item"><i class="fas fa-theater-masks"></i> Emotions</span>
    <span class="tom-perm-legend-item"><i class="fas fa-crown"></i> Full</span>
    <span class="tom-perm-legend-item tom-perm-legend-spawn"><i class="fas fa-crown" style="color:#4ade80"></i> Spawn</span>
    <span class="tom-perm-legend-sep">·</span>
    <span class="tom-perm-legend-hint"><i class="fas fa-info-circle"></i> Right-click crown for token spawn</span>
  </div>

  <!-- Footer -->
  <footer class="tom-perm-footer">
    <button type="button" class="tom-btn" data-action="close">Cancel</button>
    <button type="button" class="tom-btn tom-btn-primary" data-action="save">
      <i class="fas fa-save"></i> Save Permissions
    </button>
  </footer>

</div>
