{{!-- Macro Tab --}}
<section class="tab-content {{#if tab.active}}active{{/if}}" data-tab="macro">
    <fieldset class="potion-fieldset macro-fieldset">
        <legend><i class="fas fa-code"></i> Item Macro</legend>

        <div class="macro-editor-container">
            {{#if isEditable}}
            <input type="hidden" name="flags.itemacro.macro.name" value="{{item.name}}" />
            <textarea name="flags.itemacro.macro.command" class="macro-textarea" spellcheck="false"
                placeholder="Enter Javascript code here...">{{macroCommand}}</textarea>

            {{else}}
            <div class="macro-content">
                <pre><code>{{macroCommand}}</code></pre>
            </div>
            {{/if}}
        </div>

        <div class="macro-info">
            <p class="hint">
                <i class="fas fa-info-circle"></i> This script executes when the class ability is used.
                Requires the <strong>Item Macro</strong> module for execution, but you can edit the script here.
            </p>
        </div>
    </fieldset>

    <fieldset class="potion-fieldset macro-settings-fieldset">
        <legend><i class="fas fa-cog"></i> Macro Settings</legend>

        <div class="form-group">
            <label>Run as GM</label>
            <div class="form-fields">
                <input type="checkbox" name="flags.shadowdark-extras.itemMacro.runAsGm" {{#if
                    sdxFlags.itemMacro.runAsGm}}checked{{/if}} />
            </div>
            <p class="hint">Execute the macro with GM permissions. Recommended for complex effects.</p>
        </div>

        <div class="form-group">
            <label>Run Macro</label>
            <div class="form-fields">
                <select name="flags.shadowdark-extras.itemMacro.macroTrigger">
                    <option value="all" {{#if (eq sdxFlags.itemMacro.macroTrigger "all")}}selected{{/if}}>On All (always run)</option>
                    <option value="onSuccess" {{#if (eq sdxFlags.itemMacro.macroTrigger "onSuccess")}}selected{{/if}}>On Success</option>
                    <option value="onCritical" {{#if (eq sdxFlags.itemMacro.macroTrigger "onCritical")}}selected{{/if}}>On Critical Success</option>
                    <option value="onFailure" {{#if (eq sdxFlags.itemMacro.macroTrigger "onFailure")}}selected{{/if}}>On Failure</option>
                </select>
            </div>
            <p class="hint">Choose when the macro should trigger based on the ability check result.</p>
        </div>
    </fieldset>
</section>
