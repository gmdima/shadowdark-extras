{{!-- Macro Tab --}}
<section class="tab-content {{#if tab.active}}active{{/if}}" data-tab="macro">
    <fieldset class="potion-fieldset macro-fieldset">
        <legend><i class="fas fa-code"></i> Item Macro</legend>

        <div class="macro-editor-container">
            {{#if isEditable}}
            <input type="hidden" name="flags.itemacro.macro.name" value="{{item.name}}" />
            <textarea name="flags.itemacro.macro.command" class="macro-textarea" spellcheck="false"
                placeholder="Enter Javascript code here...">{{macroCommand}}</textarea>

            {{else}}
            <div class="macro-content">
                <pre><code>{{macroCommand}}</code></pre>
            </div>
            {{/if}}
        </div>

        <div class="macro-info">
            <p class="hint">
                <i class="fas fa-info-circle"></i> This script executes when the NPC feature is used.
                Requires the <strong>Item Macro</strong> module for execution, but you can edit the script here.
            </p>
        </div>
    </fieldset>

    <fieldset class="potion-fieldset macro-settings-fieldset">
        <legend><i class="fas fa-cog"></i> Macro Settings</legend>

        <div class="form-group">
            <label>Run as GM</label>
            <div class="form-fields">
                <input type="checkbox" name="flags.shadowdark-extras.itemMacro.runAsGm" {{#if
                    sdxFlags.itemMacro.runAsGm}}checked{{/if}} />
            </div>
            <p class="hint">Execute the macro with GM permissions. Recommended for complex effects.</p>
        </div>

        <div class="form-group">
            <label>Execute on Use</label>
            <div class="form-fields">
                <input type="checkbox" name="flags.shadowdark-extras.itemMacro.executeOnUse" {{#if
                    sdxFlags.itemMacro.executeOnUse}}checked{{/if}} />
            </div>
            <p class="hint">Enable this to trigger the macro automatically when using the feature.</p>
        </div>
    </fieldset>
</section>